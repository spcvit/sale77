
/**
* @version 3.2.7.1
* @package PWebContact
* @copyright © 2014 Perfect Web sp. z o.o., All rights reserved. http://www.perfect-web.co
* @license GNU General Public License http://www.gnu.org/licenses/gpl-3.0.html
* @author Piotr Moćko
*
* jQuery 1.8.x, 1.10.x
*/
var pwebBoxes=pwebBoxes||[];(function(a){pwebContact=function(b){this.init(b)};pwebContact.prototype=(function(){var b=0;var c=-1;var e=false;var d=null;return{constructor:pwebContact,defaults:{id:"",selector:"#pwebcontact",selectorClass:".pwebcontact",debug:false,basePath:"",baseUrl:"",ajaxUrl:"",reloadToken:false,openAuto:false,openDelay:0,maxAutoOpen:0,closeAuto:false,closeDelay:0,closeOther:true,reset:1,redirectURL:"",redirectDelay:3,layout:"slidebox",position:"left",offsetPosition:"top",tooltips:3,msgPosition:"after",msgCloseDelay:10,rulesModal:false,togglerNameOpen:"",togglerNameClose:"",slideWidth:0,slideDuration:400,slideTransition:"swing",accordionDuration:500,accordionEaseIn:"easeInBack",accordionEaseOut:"easeOutBounce",modalBackdrop:true,modalClose:true,modalStyle:"default",modalEffect:"square",modalEffectDuration:400,modalEaseIn:"easeInCubic",modalEaseOut:"easeOutCubic",cookieLifetime:30,cookiePath:"/",cookieDomain:"",onLoad:function(){},onOpen:function(){},onClose:function(){},onComplete:function(f){},onError:function(f){},uploadAcceptFileTypes:/(\.|\/)(gif|jpe?g|png|doc?x|odt|txt|pdf|zip)$/i,uploadMaxSize:1048576,uploadFilesLimit:5,uploadAutoStart:true,validatorRules:[],calendars:[],calendarFirstDay:0},hidden:true,timer:false,validator:false,tooltip:false,uploader:false,uploadQueue:0,files:[],init:function(f){var h=this;this.options=a.extend({},this.defaults,f);this.options.baseUrl=document.location.protocol+"//"+document.location.host+this.options.basePath+"/";this.options.ajaxUrl=this.options.baseUrl+this.options.ajaxUrl;this.options.selector=this.options.selector+this.options.id;this.options.selectorClass=this.options.selectorClass+this.options.id;this.element=a(this.options.selector);this.Msg=a(this.options.selector+"_msg");this.Form=a(this.options.selector+"_form");this.ButtonSend=a(this.options.selector+"_send");this.Toggler=a(this.options.selector+"_toggler");this.Box=a(this.options.selector+"_box");this.Container=a(this.options.selector+"_container");d=a(this.options.selector+"_token");this.Form[0].reset();if(!e&&this.Form.find(".pweb-captcha").length){e=true}this.Form.submit(function(j){j.preventDefault()});if(typeof Joomla.JText._!=="function"){Joomla.JText.strings=Joomla.JText;Joomla.JText._=function(j,k){return typeof this.strings[j.toUpperCase()]!=="undefined"?this.strings[j.toUpperCase()]:k}}if(this.options.layout=="slidebox"){this.element.appendTo(document.body);this.options.togglerSlide=this.Box.hasClass("pweb-toggler-slide");this.options.togglerHidden=this.Box.hasClass("pweb-toggler-hidden");this.options.slidePos=this.element.css("position");if(!this.options.slideWidth){this.options.slideWidth=parseInt(this.Box.css("max-width"))}this.Box.css("width",this.options.slideWidth);if(this.options.position=="left"||this.options.position=="right"){this.Box.css(this.options.position,-this.options.slideWidth);this.options.togglerWidth=this.options.togglerSlide?this.Toggler.outerWidth():0;this.options.togglerHeight=this.options.togglerSlide?parseInt(this.Box.css("top")):0;this.options.slideOffset=parseInt(this.element.css("top"));if(this.options.togglerSlide){this.Toggler.css(this.options.position=="left"?"right":"left",-this.Toggler.outerWidth())}}else{this.Box.css(this.options.position,-this.Box.height());this.options.togglerWidth=0;this.options.togglerHeight=this.options.togglerSlide?this.Toggler.outerHeight():0;this.options.slideOffset=0;if(this.options.togglerSlide){this.Toggler.css(this.options.position=="top"?"bottom":"top",-this.Toggler.outerHeight())}}this.Box.addClass("pweb-closed").removeClass("pweb-init");if(this.options.togglerHidden){this.Toggler.fadeOut(0).removeClass("pweb-closed").addClass("pweb-opened");if(this.options.togglerNameClose){this.Toggler.find(".pweb-text").text(this.options.togglerNameClose)}}if(this.options.closeOther){pwebBoxes.push(this)}this.isFF=navigator.userAgent.indexOf("Gecko")!=-1;a(window).scroll(function(j){if(!h.hidden&&h.element.css("position")=="absolute"&&h.options.slidePos=="fixed"){var k=a(this).scrollTop();if(h.options.position=="bottom"){k=k+a(this).height();if(k>h.element.offset().top){if(h.isFF){h.element.css("top",k)}else{h.element.stop().animate({top:k},250,"linear")}}}else{k=k+h.options.slideOffset;if(k<h.element.offset().top){if(h.isFF){h.element.css("top",k)}else{h.element.stop().animate({top:k},250,"linear")}}}}})}else{if(this.options.layout=="modal"){this.element.appendTo(document.body);if(!this.initModal()){return false}}else{if(this.options.layout=="accordion"){this.initAccordion()}}}this.options.onLoad.apply(this);var g=false;if(document.location.hash.indexOf(this.options.selector+":")!==-1){var i=document.location.hash.replace(this.options.selector+":","");if(i.indexOf("open")===0&&(typeof i[4]==="undefined"||i[4]==":")){i=i.replace(/open(:)?/i,"");g=true}if(i){this.preloadFields(i)}}if(this.options.tooltips){this.initTooltips()}if(this.Form.find(".pweb-uploader").length){this.initUploader()}this.initTextareaCounters();this.initChosen();this.initCalendar();this.initHiddenFields();this.initValidator();if(this.Box.hasClass("pweb-labels-over")){this.initLabelsOverFields()}if(this.options.rulesModal){this.initModalRules()}this.ButtonSend.click(function(){h.submitForm()});if(this.options.reset==3){this.ButtonReset=a(this.options.selector+"_reset");this.ButtonReset.click(function(){a(this).hide();h.resetForm()})}if(this.options.layout!="static"){if(this.options.togglerNameClose){this.options.togglerNameOpen=this.Toggler.find(".pweb-text").text()}a(this.options.selectorClass+"_toggler").click(function(j){j.preventDefault();h.toggleForm(-1,-1,this,j)});if(g){this.autoPopupOnPageLoad()}else{if(this.options.openAuto){if(this.options.maxAutoOpen>0){if(!this.initAutoPopupCookie()){this.options.openAuto=false}}switch(this.options.openAuto){case 1:this.autoPopupOnPageLoad();break;case 2:this.autoPopupOnPageScroll();break;case 3:this.autoPopupOnPageExit()}}}}if(typeof navigator.cookieEnabled!=="undefined"&&navigator.cookieEnabled===false){this.displayMsg(Joomla.JText._("MOD_PWEBCONTACT_COOKIES_ERR"),"error")}else{this.displayMsg("","")}return this},initModal:function(){var f=this;if(typeof a.fn.modal==="function"){this.Modal=a(this.options.selector+"_modal");this.options.modalClass="pwebcontact"+this.options.id+"_modal-open pweb-modal-open pweb-modal-"+this.options.modalStyle;this.Modal.appendTo(document.body).modal({show:false,keyboard:false,backdrop:!this.options.modalClose&&this.options.modalBackdrop?"static":this.options.modalBackdrop}).on("hidden",function(g){g.stopPropagation();if(g.target!==g.currentTarget){return}f.toggleForm(0);a(document.body).removeClass(f.options.modalClass)}).on("show",function(g){g.stopPropagation();if(g.target!==g.currentTarget){return}a(document.body).addClass(f.options.modalClass)}).click(function(g){if(g.target!==g.currentTarget||!f.options.modalClose){return}f.toggleForm(0)});if(this.options.modalEffect!=="default"){this.initGenie()}return true}else{if(this.options.debug){this.debug("Bootstrap Modal Plugin is not loaded")}}return false},initModalRules:function(){var g=this,f=this.Form.find(".pweb-field-checkbox a");if(!f.length){return}if(typeof a.fn.modal==="function"){f.click(function(j){var h=a(this).attr("href");if(h.indexOf("//")!==-1&&h.indexOf("//")<=6&&h.indexOf(document.location.host)===-1){return}j.preventDefault();var i={};if(g.options.layout=="modal"){i.backdrop=0}a('<div class="pweb-modal modal hide fade'+(g.Box.hasClass("pweb-rtl")?" pweb-rtl":"")+'"><button type="button" class="pweb-button-close" data-dismiss="modal" aria-hidden="true">&times;</button><div class="modal-body pweb-progress"></div></div>').appendTo(document.body).modal(i).on("hidden",function(){a(this).remove()}).find(".modal-body").load(h,function(){a(this).removeClass("pweb-progress")})});return true}else{if(this.options.debug){this.debug("Bootstrap Modal Plugin is not loaded")}}return false},initGenie:function(){var f=this,g=this.Box.attr("class").match(/pweb-bg-[a-z]+/i);this.options.modalGenieClass="pweb-genie pweb-"+this.options.modalEffect+"-"+(this.options.position!=="static"?this.options.position:"bottom")+" pwebcontact"+this.options.id+"-genie"+(this.Box.hasClass("pweb-radius")?" pweb-radius":"")+(this.Box.hasClass("pweb-shadow")?" pweb-shadow":"")+(g?" "+g[0]:"");if(this.options.modalEffect==="smooth"){this.options.modalEaseIn="easeInQuart";this.options.modalEaseOut="easeOutQuart"}else{if(this.options.modalEffect==="rotate"){this.options.modalEaseIn="easeInQuint";this.options.modalEaseOut="easeOutQuint"}}this.Modal.on("show",function(h){h.stopPropagation();if(h.target!==h.currentTarget){return}if(typeof f.eventSource!=="undefined"&&a(f.eventSource).length){f.Container.css({visibility:"hidden"})}}).on("shown",function(h){h.stopPropagation();if(h.target!==h.currentTarget){return}if(typeof f.eventSource!=="undefined"&&a(f.eventSource).length){a(f.eventSource).trigger("modalOpen")}});a(this.options.selectorClass+"_toggler").on("modalOpen",function(){a(this).effect({effect:"transfer",to:f.Container,duration:f.options.modalEffectDuration,easing:f.options.modalEaseIn,className:"pweb-genie-show "+f.options.modalGenieClass,complete:function(){f.Container.css({visibility:"visible"})}})});this.Container.on("modalClose",function(){a(this).css({visibility:"hidden"}).effect({effect:"transfer",to:a(f.eventSource),duration:f.options.modalEffectDuration,easing:f.options.modalEaseOut,className:"pweb-genie-hide "+f.options.modalGenieClass,complete:function(){f.Modal.modal("hide")}})})},initAccordion:function(){var f=this;a(this.options.selectorClass+"_toggler").on("openAccordion",function(){f.Box.slideDown({duration:f.options.accordionDuration,easing:f.options.accordionEaseOut,complete:function(){var g=a(window).height(),i=f.element.outerHeight(),h=f.element.offset().top;if(h+i>a(window).scrollTop()+g){if(i<g){h=h+i-g}a("html,body").animate({scrollTop:parseInt(h)},500)}}})});a(this.options.selectorClass+"_toggler").on("closeAccordion",function(){f.Box.slideUp({duration:f.options.accordionDuration,easing:f.options.accordionEaseIn})});this.Box.css("display","none").removeClass("pweb-init")},initTooltips:function(){if(typeof a.fn.tooltip==="function"){this.tooltip=true;this.Form.find("input.pweb-input.pweb-tooltip,select.pweb-tooltip,textarea.pweb-tooltip").tooltip({trigger:this.options.tooltips==2?"manual":"focus",html:false});this.Form.find("fieldset.pweb-tooltip,.pweb-field-checkbox label.pweb-tooltip,.fileinput-button.pweb-tooltip").tooltip({trigger:this.options.tooltips==2?"manual":"hover",html:false});this.Form.find(".pweb-tooltip").on("show",function(f){f.stopPropagation();if(f.target!==f.currentTarget){return}}).on("shown",function(f){f.stopPropagation();if(f.target!==f.currentTarget){return}}).on("hide",function(f){f.stopPropagation();if(f.target!==f.currentTarget){return}}).on("hidden",function(f){f.stopPropagation();if(f.target!==f.currentTarget){return}});return true}else{if(this.options.debug){this.debug("Bootstrap Tooltip Plugin is not loaded")}}return false},initCalendar:function(){if(typeof Calendar==="undefined"){return false}if(this.options.calendars.length){var f=this;a.each(this.options.calendars,function(g,h){var i="pwebcontact"+f.options.id+"_field-"+h.id;Calendar.setup({inputField:i,button:i+"_btn",onUpdate:function(){this.inputField.focus()},ifFormat:typeof h.format!=="undefined"?h.format:null,firstDay:f.options.calendarFirstDay,electric:false})});this.Form.find(".pweb-calendar-btn").click(function(){if(f.element.css("position")=="fixed"||f.options.layout=="modal"){a("div.calendar:last").css("position","fixed")}a(this).prev().focus()})}return true},initChosen:function(){return;if(typeof a.fn.chosen==="function"){this.Form.find("select").chosen({disable_search_threshold:50,allow_single_deselect:true});return true}else{if(this.options.debug){this.debug("jQuery Chosen Plugin is not loaded")}}return false},initLabelsOverFields:function(){this.Form.find("input.pweb-input,textarea").focus(function(){a("#"+a(this).attr("id")+"-lbl").parent().hide()}).blur(function(){if(!this.value){a("#"+a(this).attr("id")+"-lbl").parent().show()}}).each(function(){if(this.value){a("#"+a(this).attr("id")+"-lbl").parent().hide()}});this.Form.find("select").focus(function(){a("#"+a(this).attr("id")+"-lbl").parent().hide();a(this).removeClass("pweb-blank").children(":first").text(a(this).data("default-option"))}).blur(function(){if(a(this).val()==""||a(this).val()==null){a(this).addClass("pweb-blank").children(":first").text(" ");a("#"+a(this).attr("id")+"-lbl").parent().show()}}).each(function(){var f=a(this).children(":first");a(this).data("default-option",f.text());if(a(this).val()==""||a(this).val()==null){a(this).addClass("pweb-blank");f.text(" ")}else{a("#"+a(this).attr("id")+"-lbl").parent().hide()}});return true},initTextareaCounters:function(){this.Form.find("textarea[maxlength]").keyup(function(){var f=parseInt(a(this).attr("maxlength"));var g=a(this).val();if(g.length>=f){g=g.substring(0,f);a(this).val(g)}a("#"+a(this).attr("id")+"-limit").text(f-g.length)}).trigger("keyup");return true},initHiddenFields:function(){a("<input/>",{type:"hidden",name:"title",value:document.title}).appendTo(this.Form);a("<input/>",{type:"hidden",name:"url",value:document.location.href}).appendTo(this.Form);a("<input/>",{type:"hidden",name:"screen_resolution",value:screen.width+"x"+screen.height}).appendTo(this.Form);if(this.options.debug){a("<input/>",{type:"hidden",name:"debug",value:1}).appendTo(this.Form)}return true},initUploader:function(){var f=this;if(typeof a.fn.fileupload!=="function"){if(this.options.debug){this.debug("jQuery File Upload Plugin is not loaded")}return false}this.uploader=a(this.options.selector+"_uploader_container").fileupload({url:this.options.ajaxUrl+"uploader",type:"POST",dataType:"json",dataFilter:this.ajaxResponseDataFilter,accepts:"application/json; charset=utf-8",headers:{Accept:"application/json; charset=utf-8"},converters:{"text json":function(g){g=a.parseJSON(g);if(typeof g.data!=="undefined"){g=g.data}return g},"iframe json":function(g){g=a.parseJSON(g);if(typeof g.data!=="undefined"){g=g.data}return g}},formData:function(g){return a.merge(g.serializeArray(),[{name:"format",value:"json"},{name:"mid",value:f.options.id},{name:"ignoreMessages",value:true}])},autoUpload:this.options.uploadAutoStart===true,acceptFileTypes:this.options.uploadAcceptFileTypes,maxFileSize:this.options.uploadMaxSize,maxNumberOfFiles:this.options.uploadFilesLimit,getNumberOfFiles:function(){return this.filesContainer.children(".pweb-upload-success, .pweb-upload-ready").length},messages:{uploadedBytes:Joomla.JText._("MOD_PWEBCONTACT_UPLOAD_BYTES_ERR"),maxNumberOfFiles:Joomla.JText._("MOD_PWEBCONTACT_UPLOAD_LIMIT_ERR"),acceptFileTypes:Joomla.JText._("MOD_PWEBCONTACT_UPLOAD_TYPE_ERR"),maxFileSize:Joomla.JText._("MOD_PWEBCONTACT_UPLOAD_SIZE_ERR")},dropZone:this.Box,pasteZone:null,uploadTemplateId:null,downloadTemplateId:null,uploadTemplate:function(h){var g=a();a.each(h.files,function(i,j){var k=f.uploader.find(".templates .template-upload").clone();k.find(".name").text(j.name);k.find(".cancel").bind("click",function(){if(k.hasClass("pweb-upload-ready")){f.uploadQueue--}if(b==0){f.displayMsg("","")}});g=g.add(k)});return g},downloadTemplate:function(h){var g=a();a.each(h.files,function(i,k){var m=f.uploader.find(".templates .template-download").clone();m.find(".size").text(h.formatFileSize(k.size));m.find(".name").text(k.name);var j=m.find(".delete").bind("click",function(){var n=a.inArray(k.name,f.files);if(n>-1){f.files.splice(n,1)}if(b==0){f.displayMsg("","")}});if(k.name){var l={file:k.name,mid:f.options.id,format:"json",ignoreMessages:true};if(k.deleteType=="POST"){l._method="DELETE";j.data("type","POST")}l[d.attr("name")]=1;j.data("url",f.options.ajaxUrl+"uploader&"+decodeURIComponent(a.param(l)))}if(k.error){m.find(".success").remove();m.find(".error").text(k.error)}else{m.find(".warning, .error").remove();m.addClass("pweb-upload-success");f.files.push(k.name)}g=g.add(m)});return g}}).on("fileuploaddragover",function(g){f.Box.addClass("pweb-dragged");f.Box.find(".pweb-dropzone").css({width:f.Box.width(),height:f.Box.height()})}).on("fileuploaddrop",function(h,g){f.Box.removeClass("pweb-dragged")}).on("fileuploadadd",function(h,g){if(f.options.reloadToken&&b==0&&f.options.uploadAutoStart){f.ajaxCall("getToken",false)}}).on("fileuploadprocessdone",function(h,g){f.uploadQueue++;g.context.addClass("pweb-upload-ready").find(".warning,.error").remove()}).on("fileuploadprocessfail",function(h,g){g.context.each(function(i){a(this).find(".ready,.progress").remove();var j=a(this).find(".cancel");setTimeout(function(){j.click()},3000)})}).on("fileuploadstart",function(g){if(f.options.uploadAutoStart){if(b==0){f.displayMsg("","")}b=2}}).on("fileuploaddone",function(h,g){f.uploadQueue--;if(!(g.getFilesFromResponse(g)).length){f.displayMsg(Joomla.JText._("MOD_PWEBCONTACT_UPLOAD_ERR"),"error");if(g.autoUpload===false){b=5}}}).on("fileuploadfail",function(h,g){f.displayMsg(Joomla.JText._("MOD_PWEBCONTACT_UPLOAD_ERR"),"error");if(g.autoUpload===false){b=5}}).on("fileuploadalways",function(h,g){if(g.textStatus=="parsererror"){f.debug(g.jqXHR.responseText)}else{if(f.options.debug&&g.result&&typeof g.result.debug!=="undefined"&&g.result.debug){f.debug(g.result.debug,g.result.status)}}}).on("fileuploadfinished",function(h,g){if(f.uploadQueue==0){if(g.autoUpload||b==5){b=0}else{if(b==1){f.ajaxCall("sendEmail")}}}});this.Box.bind("dragleave",function(g){a(this).removeClass("pweb-dragged")});if(this.tooltip){this.uploader.find(".fileinput-button").click(function(){a(this).tooltip("hide")})}a(window).on("unload",function(){if(f.files.length){f.uploader.find(".files .delete").click()}});return true},initValidator:function(){var f=this;if(typeof a.fn.validate==="function"){if(e){setTimeout(function(){f.Form.find(".pweb-captcha input[type=text]").addClass("pweb-input required")},1000)}a.each(this.options.validatorRules,function(g,h){a.validator.addMethod("pweb"+f.options.id+"-validate-"+h.name,function(j,i){return this.optional(i)||(h.regexp).test(j)},"")});if(this.uploader){a.validator.addMethod("pweb-validate-uploader",function(h,g){return f.Container.find(".files .pweb-upload-success,.files .pweb-upload-ready").length},"")}this.validator=this.Form.validate({debug:this.options.debug,onsubmit:false,errorClass:"invalid",showErrors:function(k,h){var l,g;for(l=0;h[l];l++){var m=h[l].element;this.settings.highlight.call(this,m,this.settings.errorClass,this.settings.validClass);m=a(m);if(m.hasClass("pweb-fieldset")){m=m.parents("fieldset")}a("#"+m[0].id+"-lbl").addClass(this.settings.errorClass);if(l==0&&f.element.css("position")!="fixed"){if(f.options.layout=="modal"){var o=f.Box.outerHeight()-a(window).height();if(o>0){var p=m.parent().parent().offset().top-f.Box.offset().top;if(p>o){p=o}f.Modal.animate({scrollTop:parseInt(p)},500)}}else{if(f.element.css("position")!="fixed"){var p=m.parent().parent().offset().top-10,n=a(window).scrollTop(),j=a(window).height();if(p<n+50||p>n+j-50){p=p-j/2;a("html,body").animate({scrollTop:parseInt(p)},500)}}}}if(f.tooltip&&f.options.tooltips>=2){if(m.hasClass("pweb-single-checkbox")){m.next().tooltip("show")}else{m.tooltip("show")}}}for(l=0,g=this.validElements();g[l];l++){var m=g[l];this.settings.unhighlight.call(this,m,this.settings.errorClass,this.settings.validClass);m=a(m);if(m.hasClass("pweb-fieldset")){m=m.parents("fieldset")}a("#"+m[0].id+"-lbl").removeClass(this.settings.errorClass);if(f.tooltip&&f.options.tooltips>=2){if(m.hasClass("pweb-single-checkbox")){m.next().tooltip("hide")}else{m.tooltip("hide")}}}}});return true}else{if(this.options.debug){this.debug("jQuery Validate Plugin is not loaded")}}return false},preloadFields:function(h){var g=this;try{var f=h.split("/");a.each(f,function(l,m){m=m.split("=");if(m.length>=2){m[1]=unescape(m[1]);var k=a(g.options.selector+"_field-"+m[0]),j=k.prop("tagName").toLowerCase();if(j=="fieldset"){k.find("input").val(m[1].split(";"))}else{if(j=="select"&&k.attr("multiple")){k.val(m[1].split(";")).trigger("focus").trigger("blur")}else{if(j=="input"&&k.attr("type")=="checkbox"){k.attr("checked",m[1]!=0?true:false)}else{k.val(m[1]).trigger("focus").trigger("blur");if(j=="textarea"){k.trigger("keyup")}}}}}})}catch(i){console.log(i)}},close:function(){this.toggleForm(0)},toggleForm:function(f,l,k,g){var j=this;if(typeof f==="undefined"){f=-1}if(typeof k==="undefined"){k=this.Toggler}if(this.timer){clearTimeout(this.timer)}if(!this.hidden&&(f===-1||f===0)){this.hidden=true;if(this.Toggler.length&&!this.options.togglerHidden){this.Toggler.removeClass("pweb-opened").addClass("pweb-closed");if(this.options.togglerNameClose){this.Toggler.find(".pweb-text").text(this.options.togglerNameOpen)}}if(this.options.layout=="slidebox"){var i={};i[this.options.position]=(this.options.position=="left"||this.options.position=="right")?-this.Box.width():-this.Box.height();this.Box.stop(true,false).animate(i,this.options.slideDuration,this.options.slideTransition,function(){if(j.element.css("position")=="absolute"&&j.options.slidePos=="fixed"){var o={position:"fixed"};if(j.options.position=="left"||j.options.position=="right"){o.top=j.options.slideOffset}else{o[j.options.position]=0;if(j.options.position=="bottom"){o.top="auto"}}j.element.css(o)}}).addClass("pweb-closed");if(this.options.togglerHidden){this.Toggler.fadeOut(this.options.slideDuration)}}else{if(this.options.layout=="modal"){if(this.options.modalEffect!="default"&&typeof this.eventSource!=="undefined"){this.Container.trigger("modalClose")}else{this.Modal.modal("hide")}}else{if(this.options.layout=="accordion"){a(k).trigger("closeAccordion")}}}this.options.onClose.apply(this);if(this.options.reset==2){this.resetForm()}}else{if(this.hidden&&(f===-1||f===1)){if(typeof l==="number"&&l>=0){var m=a(this.options.selector+"_mailto");if(m.length){m[0].selectedIndex=parseInt(l);if(this.Box.hasClass("pweb-labels-over")){m.trigger("focus").trigger("blur")}}}if(a(k).length){if(a(k).data("pwebcontact-fields")){this.preloadFields(a(k).data("pwebcontact-fields"))}if(a(k).data("pwebcontact-fields-once")){this.preloadFields(a(k).data("pwebcontact-fields-once"));a(k).data("pwebcontact-fields-once","")}}this.hidden=false;if(this.Toggler.length&&!this.options.togglerHidden){this.Toggler.removeClass("pweb-closed").addClass("pweb-opened");if(this.options.togglerNameClose){this.Toggler.find(".pweb-text").text(this.options.togglerNameClose)}}if(this.options.layout=="slidebox"){if(this.options.closeOther){a.each(pwebBoxes,function(){if(this.options.id!=j.options.id&&typeof this.close==="function"){this.close()}})}var i={width:this.options.slideWidth};i[this.options.position]=0;var n=a(window).width();if(this.options.position=="left"||this.options.position=="right"){if(this.options.slideWidth+this.options.togglerWidth>n){i.width=n-this.options.togglerWidth}}else{var h=this.element.offset().left;if(this.options.offsetPosition=="right"){h=a(document).width()-h}if(this.options.slideWidth+h>n){i.width=n-h}}this.Box.stop(true,false).animate(i,this.options.slideDuration,this.options.slideTransition,function(){if(j.options.slidePos=="fixed"){var o={position:"absolute"};if(j.options.position=="left"||j.options.position=="right"){o.top=j.element.offset().top;if(j.Box.height()+j.options.togglerHeight+o.top-a(window).scrollTop()>a(window).height()){o.top=j.element.offset().top;j.element.css(o)}}else{if(j.Box.height()+j.options.togglerHeight>a(window).height()){o.top=j.element.offset().top;if(j.options.position=="bottom"){o.bottom="auto"}j.element.css(o)}}}}).css("overflow","visible").removeClass("pweb-closed");if(this.options.togglerHidden){this.Toggler.fadeIn(this.options.slideDuration)}}else{if(this.options.layout=="modal"){if(this.options.modalEffect!="default"&&a(k).length){this.eventSource=k}this.Modal.modal("show")}else{if(this.options.layout=="accordion"){a(k).trigger("openAccordion")}}}this.options.onOpen.apply(this)}}},resetForm:function(){if(b==3){var g=this;setTimeout(function(){b=0},5000);b=4;c=-1;this.displayMsg("","");if(!this.options.redirectURL){this.ajaxCall("getToken")}this.ButtonSend.show();this.Form.find("textarea.pweb-charslimit").each(function(){a("#"+a(this).attr("id")+"-charsleft").text(parseInt(a(this).attr("maxlength")))});if(this.validator){this.validator.resetForm()}this.Form[0].reset();if(this.Box.hasClass("pweb-labels-over")){this.Form.find("input.pweb-input,textarea,select").trigger("focus").trigger("blur")}if(this.uploader){var f=this.uploader.find(".files");f.find(".cancel,.delete").click();f.empty();this.files=[];this.uploadQueue=0}if(e&&typeof Recaptcha!=="undefined"&&!this.options.redirectURL){Recaptcha.reload()}}},submitForm:function(){var g=this;if(b==1||b==2||b==3||b==5){return false}if(this.validator&&!this.validator.form()){return false}if(b==4){var h=Joomla.JText._("MOD_PWEBCONTACT_SEND_ERR");if(this.options.msgPosition=="popup"){this.displayAlert(h,"error")}else{this.scrollToMsg();this.displayMsg(h,"error")}return false}b=1;this.scrollToMsg();if(this.options.reloadToken){this.ajaxCall("getToken",false)}if(e&&c===-1){this.ajaxCall("checkCaptcha",false)}if(c===false){if(typeof Recaptcha!=="undefined"){Recaptcha.reload()}c=-1;return false}if(this.uploader&&!this.options.uploadAutoStart){var f=this.uploader.find(".files .pweb-upload-ready");if(f.length){this.displayMsg(Joomla.JText._("MOD_PWEBCONTACT_UPLOADING"),"progress");f.each(function(i){var j=a(this).data("data");if(typeof j.submit==="function"){j.submit()}});return true}}if(b==1){this.ajaxCall("sendEmail")}},ajaxCall:function(i,f){var g=this,h={mid:this.options.id,format:"json",ignoreMessages:true};if(i=="sendEmail"||i=="checkCaptcha"){if(this.uploader&&this.files.length&&i=="sendEmail"){h.attachments=this.files}h=decodeURIComponent(a.param(h))+"&"+this.Form.serialize()}if(typeof f==="undefined"){f=true}a.ajax({url:this.options.ajaxUrl+i,type:"POST",cache:false,async:f,data:h,dataType:"json",dataFilter:this.ajaxResponseDataFilter,beforeSend:function(){if(i=="sendEmail"||!f){g.displayMsg(Joomla.JText._("MOD_PWEBCONTACT_SENDING"),"progress")}}}).done(function(j,m,k){if(typeof j.data!=="undefined"&&typeof j.data.status!=="undefined"){var l=j.data;if(!f){g.displayMsg("","")}if(i=="getToken"){g.options.reloadToken=false;d.attr("name",l.token)}else{if(l.debug){g.debug(l.debug,l.status)}if(typeof l.deleted!=="undefined"&&!g.options.reset&&l.deleted&&g.uploader){g.uploader.find(".files").empty();g.files=[];g.uploadQueue=0}if(l.status>=1&&l.status<=199){if(i=="sendEmail"){b=3;g.options.onComplete.apply(g,[l]);if(g.uploader){g.uploader.find(".files .pweb-upload-success .delete").remove()}if(g.options.reset==1){g.resetForm()}else{if(g.options.reset==2){g.ButtonSend.hide()}else{if(g.options.reset==3){g.ButtonSend.hide();g.ButtonReset.show()}else{b=4;setTimeout(function(){b=0},5000)}}}if(g.options.msgPosition=="popup"){g.displayAlert(l.msg,"success");l.msg=""}g.displayMsg(l.msg,"success");if(g.options.closeAuto){g.autoCloseOnSuccess()}if(g.options.redirectURL){g.redirectOnSuccess()}}else{if(i=="checkCaptcha"){c=true}}}else{if(i=="checkCaptcha"){c=false;g.Form.find(".pweb-captcha input").removeClass("valid").addClass("invalid")}if(typeof l.invalid!=="undefined"){g.Form.find(".invalid").removeClass("invalid");a.each(l.invalid,function(n,p){var o=a(g.options.selector+"_"+p);if(o.is("input,textarea,select")){o.addClass("invalid")}a(g.options.selector+"_"+p+"-lbl").addClass("invalid")})}g.options.onError.apply(g,[l]);b=0;if(l.status>=300&&!g.options.debug){b=5;g.ButtonSend.hide()}if(g.options.msgPosition=="popup"){g.displayAlert(l.msg,"error");l.msg=""}g.displayMsg(l.msg,"error")}}}else{g.displayError(m,k.responseText.indexOf("<html")===-1?k.responseText:"")}}).fail(function(j,l,k){g.displayError(j.status+" "+k,j.responseText.indexOf("<html")===-1?j.responseText:"")})},ajaxResponseDataFilter:function(i,h){if(h==="iframe json"&&i&&typeof i==="object"){i=a(i[0].body).text()}if(h.indexOf("json")!==-1&&typeof i==="string"&&(i.indexOf("{")!==0||i[i.length-1]!=="}")){var g=i.match(/{"success":.+{"status":[0-9]+(,"[a-z]+":.+)+}}/i);if(g){if(typeof JSON.stringify==="function"){var f=a.parseJSON(g[0]);if(typeof f.data.debug==="undefined"||!f.data.debug){f.data.debug=[]}f.data.debug.push(i.replace(g[0]," "));i=JSON.stringify(f)}else{i=g[0]}}}return i},scrollToMsg:function(){if(this.options.msgPosition=="before"||this.options.msgPosition=="after"){if(this.options.layout=="modal"){var f=this.options.msgPosition=="after"?this.Box.outerHeight()-a(window).height():0;if(f>=0){this.Modal.animate({scrollTop:f},500)}}else{if(this.element.css("position")!="fixed"){var f=this.Msg.offset().top-20;if(this.options.msgPosition=="after"){f=f+60+this.Msg.height()-a(window).height()}a("html,body").animate({scrollTop:parseInt(f)},500)}}}},initAutoPopupCookie:function(){if(typeof a.cookie==="function"){var f=parseInt(a.cookie("pwebcontact"+this.options.id+"_openauto"));f=isNaN(f)?1:f+1;if(f<=this.options.maxAutoOpen){a.cookie("pwebcontact"+this.options.id+"_openauto",f,{domain:this.options.cookieDomain,path:this.options.cookiePath,expires:this.options.cookieLifetime});return true}}else{if(this.options.debug){this.debug("jQuery Cookie Plugin is not loaded")}}return false},autoPopupOnPageLoad:function(){if(this.options.openDelay){this.timer=this.delay(this.toggleForm,this.options.openDelay,this,[1])}else{this.toggleForm(1)}},autoPopupOnPageScroll:function(){var f=this;this.autoOpen=true;a(window).scroll(function(){if(f.autoOpen){f.autoOpen=false;if(f.options.openDelay){f.timer=f.delay(f.toggleForm,f.options.openDelay,f,[1])}else{f.toggleForm(1)}}})},autoPopupOnPageExit:function(){var f=this;this.autoOpen=-1;a(window).mousemove(function(g){if(f.autoOpen==-1&&g.clientY>70){f.autoOpen=1}else{if(f.autoOpen==1&&g.clientY<30){f.autoOpen=0;if(f.options.openDelay){f.timer=f.delay(f.toggleForm,f.options.openDelay,f,[1])}else{f.toggleForm(1)}}}})},autoCloseOnSuccess:function(){if(this.options.closeDelay){this.timer=this.delay(this.toggleForm,this.options.closeDelay,this,[0])}else{this.toggleForm(0)}},redirectOnSuccess:function(){var f=this;setTimeout(function(){document.location=f.options.redirectURL},this.options.redirectDelay*1000)},delay:function(h,g,i,f){return setTimeout(function(){return h.apply(i,f||arguments)},g)},displayError:function(h,f){if(!this.options.debug){b=5;this.ButtonSend.hide()}else{b=0}var g=Joomla.JText._("MOD_PWEBCONTACT_REQUEST_ERR")+h;if(this.options.msgPosition=="popup"){this.displayAlert(g,"error")}else{this.displayMsg(g,"error")}if(f){this.debug(f)}},displayMsg:function(f,g){this.Msg.html(f?f:"&nbsp;").attr("class",g?"pweb-"+g:"")},displayAlert:function(f,g,h,j){if(typeof a.fn.alert==="function"){var i=a('<div class="pweb-alert alert alert-block '+(g?"alert-"+g:"")+' fade in"><button data-dismiss="alert" class="close" type="button">&times;</button>'+(typeof h!=="undefined"?'<h4 class="alert-heading">'+h+"</h4>":"")+"<p>"+f+"</p></div>").alert().appendTo(document.body);if((typeof j==="undefined"||j)&&this.options.msgCloseDelay){setTimeout(function(){i.alert("close")},this.options.msgCloseDelay*1000)}}else{i(f.replace("<br>","\r\n"))}},debug:function(f,g){if(a.isArray(f)){f=f.join("<br>")}if(typeof g!=="undefined"){f=f+"<br>Response code: "+g}this.displayAlert(f,"info","Perfect Ajax Popup Contact Form Debug",false)}}})();pwebContact.options=pwebContact.prototype.options})(window.jQuery);